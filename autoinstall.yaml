autoinstall:
    version: 1
    source:
        id: ubuntu-desktop-minimal
    debconf-selections: |
        jackd2 jackd/tweak_rt_limits string true
    packages:
        - bibata-cursor-theme
        - dropbear
        - gnome-software-plugin-flatpak
        - gnome-tweaks
        - jackd
        - orchis-gtk-theme
        - papirus-icon-theme
        - pipewire-jack
        - pipx
        - pulseaudio-module-jack
    codecs:
        install: true
    drivers:
        install: true
    late-commands:
        - curtin in-target -- usermod -aG audio $(ls /home)
        - curtin in-target -- wget -qO /etc/sysctl.d/swappiness.conf https://github.com/rauldipeas/ubuntu-autoinstall/raw/main/swappiness.conf
        - curtin in-target -- wget -qO /etc/default/grub.d/rtcqs.cfg https://github.com/rauldipeas/ubuntu-autoinstall/raw/main/rtcqs.cfg
        - curtin in-target -- update-grub
        - curtin in-target -- wget -qO /etc/initramfs-tools/modules https://github.com/rauldipeas/ubuntu-autoinstall/raw/main/modules
        - curtin in-target -- update-initramfs -u -k all
        - curtin in-target -- wget -qO /etc/udev/rules.d/99-cpu-dma-latency.rules https://github.com/Ardour/ardour/raw/master/tools/udev/99-cpu-dma-latency.rules
        - curtin in-target -- flatpak remote-add --if-not-exists flathub-beta https://flathub.org/beta-repo/flathub-beta.flatpakrepo
        - curtin in-target -- flatpak install -y com.github.tchx84.Flatseal
        - curtin in-target -- flatpak install -y fm.reaper.Reaper
        - curtin in-target -- flatpak install -y org.gimp.GIMP
        - curtin in-target -- flatpak install -y org.kde.kdenlive
        - curtin in-target -- flatpak install -y org.pipewire.Helvum
    updates: all
    shutdown: reboot